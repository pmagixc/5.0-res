-- 基础信息
local base_info = {
	group_id = 250041002
}

--================================================================
-- 
-- 配置
-- 
--================================================================

-- 怪物
monsters = {
}

-- NPC
npcs = {
}

-- 装置
gadgets = {
	-- 222
	{ config_id = 2001, gadget_id = 70360002, pos = { x = 1.122, y = 45.500, z = -65.381 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 1 },
	{ config_id = 2011, gadget_id = 70950010, pos = { x = 15.331, y = 47.946, z = -75.016 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2012, gadget_id = 70950010, pos = { x = 30.534, y = 52.019, z = -75.016 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2013, gadget_id = 70950010, pos = { x = 36.425, y = 53.598, z = -75.016 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2014, gadget_id = 70950010, pos = { x = 58.670, y = 59.559, z = -75.016 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2015, gadget_id = 70950010, pos = { x = 72.107, y = 63.159, z = -75.016 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2016, gadget_id = 70950010, pos = { x = 71.998, y = 63.130, z = -75.016 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2017, gadget_id = 70950010, pos = { x = 13.960, y = 47.578, z = -84.753 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2018, gadget_id = 70950010, pos = { x = 35.658, y = 53.392, z = -84.753 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2019, gadget_id = 70950010, pos = { x = 45.900, y = 56.137, z = -84.753 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2020, gadget_id = 70950010, pos = { x = 54.393, y = 58.412, z = -84.753 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2021, gadget_id = 70950010, pos = { x = 76.426, y = 64.316, z = -84.753 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2022, gadget_id = 70950010, pos = { x = 77.596, y = 64.629, z = -84.753 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2023, gadget_id = 70310020, pos = { x = 24.729, y = 49.859, z = -88.045 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2024, gadget_id = 70310020, pos = { x = 47.489, y = 56.017, z = -72.034 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2025, gadget_id = 70310020, pos = { x = 65.413, y = 60.814, z = -87.173 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2026, gadget_id = 70310020, pos = { x = 83.289, y = 65.540, z = -72.114 }, rot = { x = 0.000, y = 0.000, z = 15.000 }, level = 1 },
	{ config_id = 2028, gadget_id = 70120004, pos = { x = 108.427, y = 69.957, z = -80.546 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 1 },
	{ config_id = 2035, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2036, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2037, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2038, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2039, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2040, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2041, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2042, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2043, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2044, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2045, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2046, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2047, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2048, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2049, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2050, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2051, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2052, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2053, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2054, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2055, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2056, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2057, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2058, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2059, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2060, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2061, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2062, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2063, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2064, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2065, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2066, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2067, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2068, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2069, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2070, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2071, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2072, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2073, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2074, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2075, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2076, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 },
	{ config_id = 2077, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -76.590 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 1 },
	{ config_id = 2078, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -79.890 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 2 },
	{ config_id = 2079, gadget_id = 70350138, pos = { x = 98.383, y = 71.636, z = -83.190 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 90, route_id = 3 }
}

-- 区域
regions = {
}

-- 触发器
triggers = {
	{ config_id = 1002029, name = "GADGET_CREATE_2029", event = EventType.EVENT_GADGET_CREATE, source = "", condition = "condition_EVENT_GADGET_CREATE_2029", action = "action_EVENT_GADGET_CREATE_2029" },
	{ config_id = 1002030, name = "SELECT_OPTION_2030", event = EventType.EVENT_SELECT_OPTION, source = "", condition = "condition_EVENT_SELECT_OPTION_2030", action = "action_EVENT_SELECT_OPTION_2030" },
	{ config_id = 1002031, name = "CHALLENGE_FAIL_2031", event = EventType.EVENT_CHALLENGE_FAIL, source = "666", condition = "", action = "action_EVENT_CHALLENGE_FAIL_2031" },
	{ config_id = 1002032, name = "TIMER_EVENT_2032", event = EventType.EVENT_TIMER_EVENT, source = "aa", condition = "", action = "action_EVENT_TIMER_EVENT_2032", trigger_count = 50 },
	{ config_id = 1002034, name = "TIMER_EVENT_2034", event = EventType.EVENT_TIMER_EVENT, source = "aa2", condition = "", action = "action_EVENT_TIMER_EVENT_2034", trigger_count = 50 }
}

-- 变量
variables = {
	{ config_id = 1, name = "WindFloraNum", value = 1, no_refresh = false }
}

--================================================================
-- 
-- 初始化配置
-- 
--================================================================

-- 初始化时创建
init_config = {
	suite = 1,
	end_suite = 0,
	rand_suite = false
}

--================================================================
-- 
-- 小组配置
-- 
--================================================================

suites = {
	{
		-- suite_id = 1,
		-- description = ,
		monsters = { },
		gadgets = { 2001 },
		regions = { },
		triggers = { "GADGET_CREATE_2029", "SELECT_OPTION_2030", "CHALLENGE_FAIL_2031" },
		rand_weight = 100
	},
	{
		-- suite_id = 2,
		-- description = ,
		monsters = { },
		gadgets = { },
		regions = { },
		triggers = { "TIMER_EVENT_2032", "TIMER_EVENT_2034" },
		rand_weight = 100
	},
	{
		-- suite_id = 3,
		-- description = ,
		monsters = { },
		gadgets = { },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 4,
		-- description = ,
		monsters = { },
		gadgets = { 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 5,
		-- description = ,
		monsters = { },
		gadgets = { 2023, 2024, 2025, 2026, 2028 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 6,
		-- description = ,
		monsters = { },
		gadgets = { 2035, 2036, 2037 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 7,
		-- description = ,
		monsters = { },
		gadgets = { 2038, 2039, 2040 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 8,
		-- description = ,
		monsters = { },
		gadgets = { 2041, 2042, 2043 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 9,
		-- description = ,
		monsters = { },
		gadgets = { 2044, 2045, 2046 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 10,
		-- description = ,
		monsters = { },
		gadgets = { 2047, 2048, 2049 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 11,
		-- description = ,
		monsters = { },
		gadgets = { 2050, 2051, 2052 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 12,
		-- description = ,
		monsters = { },
		gadgets = { 2053, 2054, 2055 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 13,
		-- description = ,
		monsters = { },
		gadgets = { 2056, 2057, 2058 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 14,
		-- description = ,
		monsters = { },
		gadgets = { 2059, 2060, 2061 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 15,
		-- description = ,
		monsters = { },
		gadgets = { 2062, 2063, 2064 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 16,
		-- description = ,
		monsters = { },
		gadgets = { 2065, 2066, 2067 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 17,
		-- description = ,
		monsters = { },
		gadgets = { 2068, 2069, 2070 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 18,
		-- description = ,
		monsters = { },
		gadgets = { 2071, 2072, 2073 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 19,
		-- description = ,
		monsters = { },
		gadgets = { 2074, 2075, 2076 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 20,
		-- description = ,
		monsters = { },
		gadgets = { 2077, 2078, 2079 },
		regions = { },
		triggers = { },
		rand_weight = 100
	}
}

--================================================================
-- 
-- 触发器
-- 
--================================================================

-- 触发条件
function condition_EVENT_GADGET_CREATE_2029(context, evt)
	if 2001 ~= evt.param1 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_GADGET_CREATE_2029(context, evt)
	-- 设置操作台选项
	if 0 ~= ScriptLib.SetWorktopOptions(context, {2}) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : set_work_options")
		return -1
	end
	
	-- 将本组内变量名为 "WindFloraNum" 的变量设置为 1
	if 0 ~= ScriptLib.SetGroupVariableValueByGroup(context, "WindFloraNum", 1, 250041002) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : set_groupVariable_by_group")
	  return -1
	end
	
	return 0
end

-- 触发条件
function condition_EVENT_SELECT_OPTION_2030(context, evt)
	-- 判断是gadgetid 2001 option_id 2
	if 2001 ~= evt.param1 then
		return false	
	end
	
	if 2 ~= evt.param2 then
		return false
	end
	
	
	return true
end

-- 触发操作
function action_EVENT_SELECT_OPTION_2030(context, evt)
	-- 添加suite2的新内容
	    ScriptLib.AddExtraGroupSuite(context, 250041002, 2)
	
	-- 添加suite3的新内容
	    ScriptLib.AddExtraGroupSuite(context, 250041002, 3)
	
	-- 添加suite4的新内容
	    ScriptLib.AddExtraGroupSuite(context, 250041002, 4)
	
	-- 添加suite5的新内容
	    ScriptLib.AddExtraGroupSuite(context, 250041002, 5)
	
	-- 创建编号为666（该挑战的识别id),挑战内容为127的区域挑战，具体参数填写方式，见DungeonChallengeData表中的注释，所有填写的值都必须是int类型
	if 0 ~= ScriptLib.ActiveChallenge(context, 666, 127, 60, 4, 666, 1) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : active_challenge")
		return -1
	end
	
	-- 延迟3秒后,向groupId为：250041002的对象,请求一次调用,并将string参数："aa" 传递过去
	if 0 ~= ScriptLib.CreateGroupTimerEvent(context, 250041002, "aa", 3) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : create_timerevent_by_group")
	  return -1
	end
	
	return 0
end

-- 触发操作
function action_EVENT_CHALLENGE_FAIL_2031(context, evt)
	-- 取消group中对应名称的TimerEvent
	if 0 ~= ScriptLib.CancelGroupTimerEvent(context, 250041002, "aa") then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : cancel_timerevent_by_group")
	  return -1
	end
	
	-- 取消group中对应名称的TimerEvent
	if 0 ~= ScriptLib.CancelGroupTimerEvent(context, 250041002, "aa2") then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : cancel_timerevent_by_group")
	  return -1
	end
	
		-- 重新生成指定group，指定suite
		if 0 ~= ScriptLib.RefreshGroup(context, { group_id = 250041002, suite = 1 }) then
	    ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : refresh_group_to_suite")
			return -1
		end
	
	-- 将本组内变量名为 "WindFloraNum" 的变量设置为 1
	if 0 ~= ScriptLib.SetGroupVariableValueByGroup(context, "WindFloraNum", 1, 250041002) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : set_groupVariable_by_group")
	  return -1
	end
	
	return 0
end

-- 触发操作
function action_EVENT_TIMER_EVENT_2032(context, evt)
	if 0 ~= ScriptLib.CreateGroupTimerEvent(context, 250041002, "aa2", 4) then
	  return -1
	end
	
	--BubblePlatform(context)
	RandomBubbleNum(context)
	
	return 0
end

-- 触发操作
function action_EVENT_TIMER_EVENT_2034(context, evt)
	-- 延迟5秒后,向groupId为：250041002的对象,请求一次调用,并将string参数："aa" 传递过去
	if 0 ~= ScriptLib.CreateGroupTimerEvent(context, 250041002, "aa", 4) then
	  return -1
	end
	
	--BubblePlatform(context)
	RandomBubbleNum(context)
	
	return 0
end

require "BubbleGame"