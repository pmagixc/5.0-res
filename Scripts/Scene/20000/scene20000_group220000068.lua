-- 基础信息
local base_info = {
	group_id = 220000068
}

--================================================================
-- 
-- 配置
-- 
--================================================================

-- 怪物
monsters = {
}

-- NPC
npcs = {
}

-- 装置
gadgets = {
	{ config_id = 434, gadget_id = 70900007, pos = { x = 132.077, y = 0.540, z = 386.064 }, rot = { x = 0.000, y = 0.791, z = 0.000 }, level = 1, persistent = true },
	{ config_id = 435, gadget_id = 70220020, pos = { x = 131.884, y = 0.540, z = 379.694 }, rot = { x = 0.000, y = 3.093, z = 0.000 }, level = 1 },
	{ config_id = 436, gadget_id = 70220020, pos = { x = 127.932, y = 0.540, z = 380.059 }, rot = { x = 0.000, y = 3.093, z = 0.000 }, level = 1 },
	{ config_id = 437, gadget_id = 70220020, pos = { x = 134.875, y = 0.540, z = 393.310 }, rot = { x = 0.000, y = 3.093, z = 0.000 }, level = 1 },
	{ config_id = 438, gadget_id = 70220020, pos = { x = 131.039, y = 0.540, z = 393.668 }, rot = { x = 0.000, y = 3.093, z = 0.000 }, level = 1 },
	{ config_id = 439, gadget_id = 70220020, pos = { x = 129.003, y = 0.540, z = 391.052 }, rot = { x = 0.000, y = 93.187, z = 0.000 }, level = 1 },
	{ config_id = 440, gadget_id = 70220020, pos = { x = 126.943, y = 0.540, z = 383.031 }, rot = { x = 0.000, y = 336.624, z = 0.000 }, level = 1 },
	{ config_id = 441, gadget_id = 70220020, pos = { x = 126.363, y = 0.540, z = 387.329 }, rot = { x = 0.000, y = 271.242, z = 0.000 }, level = 1 },
	{ config_id = 442, gadget_id = 70220020, pos = { x = 126.363, y = 0.540, z = 391.605 }, rot = { x = 0.000, y = 271.242, z = 0.000 }, level = 1 },
	{ config_id = 443, gadget_id = 70220020, pos = { x = 134.901, y = 0.540, z = 381.481 }, rot = { x = 0.000, y = 287.203, z = 0.000 }, level = 1 },
	{ config_id = 444, gadget_id = 70220020, pos = { x = 137.834, y = 0.540, z = 383.463 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 445, gadget_id = 70220020, pos = { x = 136.774, y = 0.395, z = 388.823 }, rot = { x = 3.027, y = 67.278, z = 8.709 }, level = 1 },
	{ config_id = 446, gadget_id = 70220020, pos = { x = 138.332, y = 0.540, z = 393.903 }, rot = { x = 0.000, y = 131.426, z = 0.000 }, level = 1 },
	{ config_id = 447, gadget_id = 70220020, pos = { x = 122.131, y = 0.540, z = 391.930 }, rot = { x = 0.000, y = 94.946, z = 0.000 }, level = 1 },
	{ config_id = 448, gadget_id = 70220020, pos = { x = 120.854, y = 0.540, z = 387.846 }, rot = { x = 0.000, y = 38.025, z = 0.000 }, level = 1 },
	{ config_id = 449, gadget_id = 70220020, pos = { x = 122.628, y = 0.540, z = 383.324 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 450, gadget_id = 70220020, pos = { x = 121.996, y = 0.540, z = 378.940 }, rot = { x = 0.000, y = 104.090, z = 0.000 }, level = 1 },
	{ config_id = 451, gadget_id = 70220020, pos = { x = 123.001, y = 0.540, z = 396.460 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 452, gadget_id = 70220020, pos = { x = 125.500, y = 0.540, z = 398.147 }, rot = { x = 0.000, y = 175.172, z = 0.000 }, level = 1 },
	{ config_id = 453, gadget_id = 70220020, pos = { x = 129.491, y = 0.540, z = 399.356 }, rot = { x = 0.000, y = 144.747, z = 0.000 }, level = 1 },
	{ config_id = 454, gadget_id = 70220020, pos = { x = 133.581, y = 0.540, z = 398.171 }, rot = { x = 0.000, y = 207.219, z = 0.000 }, level = 1 },
	{ config_id = 455, gadget_id = 70220020, pos = { x = 136.887, y = 0.540, z = 397.482 }, rot = { x = 0.000, y = 175.172, z = 0.000 }, level = 1 },
	{ config_id = 456, gadget_id = 70220020, pos = { x = 140.171, y = 0.540, z = 398.626 }, rot = { x = 0.000, y = 155.013, z = 0.000 }, level = 1 },
	{ config_id = 457, gadget_id = 70220020, pos = { x = 141.786, y = 0.540, z = 394.533 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 458, gadget_id = 70220020, pos = { x = 141.636, y = 0.540, z = 390.695 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 459, gadget_id = 70220020, pos = { x = 144.158, y = 0.540, z = 385.571 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 460, gadget_id = 70220020, pos = { x = 141.251, y = 0.540, z = 381.322 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 461, gadget_id = 70220020, pos = { x = 136.960, y = 0.540, z = 377.580 }, rot = { x = 0.000, y = 146.841, z = 0.000 }, level = 1 },
	{ config_id = 462, gadget_id = 70220020, pos = { x = 140.317, y = 0.540, z = 375.702 }, rot = { x = 0.000, y = 314.996, z = 0.000 }, level = 1 },
	{ config_id = 463, gadget_id = 70220020, pos = { x = 133.344, y = 0.540, z = 374.920 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 1 },
	{ config_id = 464, gadget_id = 70220020, pos = { x = 128.802, y = 0.540, z = 375.213 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 1 },
	{ config_id = 465, gadget_id = 70220020, pos = { x = 126.377, y = 0.540, z = 377.164 }, rot = { x = 0.000, y = 32.616, z = 0.000 }, level = 1 },
	{ config_id = 466, gadget_id = 70220020, pos = { x = 124.736, y = 0.540, z = 386.512 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 1 },
	{ config_id = 467, gadget_id = 70220020, pos = { x = 139.748, y = 0.540, z = 386.053 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 1 },
	{ config_id = 468, gadget_id = 70220020, pos = { x = 131.646, y = 0.540, z = 377.332 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 469, gadget_id = 70220020, pos = { x = 131.877, y = 0.540, z = 396.074 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 470, gadget_id = 70900255, pos = { x = 131.967, y = 0.540, z = 386.195 }, rot = { x = 0.000, y = 62.954, z = 0.000 }, level = 1 },
	{ config_id = 471, gadget_id = 70211001, pos = { x = 132.284, y = 0.540, z = 389.566 }, rot = { x = 0.000, y = 265.642, z = 0.000 }, level = 1, drop_tag = "战斗低级蒙德", showcutscene = true, isOneoff = true },
	{ config_id = 472, gadget_id = 70900016, pos = { x = 143.493, y = 0.244, z = 382.064 }, rot = { x = 0.000, y = 248.913, z = 0.000 }, level = 1 },
	{ config_id = 473, gadget_id = 70900016, pos = { x = 123.930, y = 0.540, z = 375.449 }, rot = { x = 0.000, y = 248.913, z = 0.000 }, level = 1 },
	{ config_id = 474, gadget_id = 70900016, pos = { x = 137.092, y = 0.540, z = 374.544 }, rot = { x = 0.000, y = 248.913, z = 0.000 }, level = 1 },
	{ config_id = 475, gadget_id = 70900016, pos = { x = 133.268, y = 0.540, z = 401.503 }, rot = { x = 0.000, y = 248.913, z = 0.000 }, level = 1 },
	{ config_id = 476, gadget_id = 70900016, pos = { x = 119.802, y = 0.540, z = 390.961 }, rot = { x = 0.000, y = 248.913, z = 0.000 }, level = 1 },
	{ config_id = 477, gadget_id = 70220020, pos = { x = 142.226, y = 0.540, z = 397.787 }, rot = { x = 0.000, y = 90.000, z = 0.000 }, level = 1 },
	{ config_id = 478, gadget_id = 70220020, pos = { x = 143.765, y = 0.540, z = 389.406 }, rot = { x = 0.000, y = 50.636, z = 0.000 }, level = 1 },
	{ config_id = 479, gadget_id = 70220020, pos = { x = 142.896, y = 0.540, z = 378.435 }, rot = { x = 0.000, y = 114.743, z = 0.000 }, level = 1 },
	{ config_id = 480, gadget_id = 70220001, pos = { x = 129.988, y = 0.540, z = 377.332 }, rot = { x = 0.000, y = 287.973, z = 0.000 }, level = 1 },
	{ config_id = 481, gadget_id = 70220001, pos = { x = 121.902, y = 0.540, z = 388.906 }, rot = { x = 0.000, y = 107.070, z = 0.000 }, level = 1 },
	{ config_id = 482, gadget_id = 70220001, pos = { x = 133.560, y = 0.540, z = 395.817 }, rot = { x = 0.000, y = 19.921, z = 0.000 }, level = 1 },
	{ config_id = 483, gadget_id = 70220001, pos = { x = 139.471, y = 0.540, z = 376.990 }, rot = { x = 0.000, y = 259.955, z = 0.000 }, level = 1 }
}

-- 区域
regions = {
}

-- 触发器
triggers = {
	{ config_id = 1000135, name = "GADGET_STATE_CHANGE_135", event = EventType.EVENT_GADGET_STATE_CHANGE, source = "", condition = "condition_EVENT_GADGET_STATE_CHANGE_135", action = "action_EVENT_GADGET_STATE_CHANGE_135" },
	{ config_id = 1000136, name = "GADGET_STATE_CHANGE_136", event = EventType.EVENT_GADGET_STATE_CHANGE, source = "", condition = "", action = "", trigger_count = 0, tag = "666" },
	{ config_id = 1000137, name = "CHALLENGE_SUCCESS_137", event = EventType.EVENT_CHALLENGE_SUCCESS, source = "888", condition = "condition_EVENT_CHALLENGE_SUCCESS_137", action = "action_EVENT_CHALLENGE_SUCCESS_137" },
	{ config_id = 1000138, name = "CHALLENGE_FAIL_138", event = EventType.EVENT_CHALLENGE_FAIL, source = "888", condition = "", action = "action_EVENT_CHALLENGE_FAIL_138", trigger_count = 0 }
}

-- 变量
variables = {
}

--================================================================
-- 
-- 初始化配置
-- 
--================================================================

-- 初始化时创建
init_config = {
	suite = 1,
	end_suite = 0,
	rand_suite = false
}

--================================================================
-- 
-- 小组配置
-- 
--================================================================

suites = {
	{
		-- suite_id = 1,
		-- description = ,
		monsters = { },
		gadgets = { 434, 472, 473, 474, 475, 476 },
		regions = { },
		triggers = { "GADGET_STATE_CHANGE_135" },
		rand_weight = 100
	},
	{
		-- suite_id = 2,
		-- description = suite_2,
		monsters = { },
		gadgets = { 434, 435, 436, 437, 438, 439, 440, 441, 442, 443, 444, 445, 446, 447, 448, 449, 450, 451, 452, 453, 454, 455, 456, 457, 458, 459, 460, 461, 462, 463, 464, 465, 466, 467, 468, 469, 470, 472, 473, 474, 475, 476, 477, 478, 479, 480, 481, 482, 483 },
		regions = { },
		triggers = { "GADGET_STATE_CHANGE_136", "CHALLENGE_SUCCESS_137", "CHALLENGE_FAIL_138" },
		rand_weight = 100
	}
}

--================================================================
-- 
-- 触发器
-- 
--================================================================

-- 触发条件
function condition_EVENT_GADGET_STATE_CHANGE_135(context, evt)
	if 434 ~= evt.param2 or GadgetState.GearStart ~= evt.param1 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_GADGET_STATE_CHANGE_135(context, evt)
		-- 重新生成指定group，指定suite
		if 0 ~= ScriptLib.RefreshGroup(context, { group_id = 220000068, suite = 2 }) then
	    ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : refresh_group_to_suite")
			return -1
		end
	
	-- 创建编号为888（该挑战的识别id),挑战内容为165的区域挑战，具体参数填写方式，见DungeonChallengeData表中的注释，所有填写的值都必须是int类型
	if 0 ~= ScriptLib.ActiveChallenge(context, 888, 165, 45, 7, 666, 4) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : active_challenge")
		return -1
	end
	
	return 0
end

-- 触发条件
function condition_EVENT_CHALLENGE_SUCCESS_137(context, evt)
	-- 判断指定group组剩余gadget数量是否是45 
	if ScriptLib.CheckRemainGadgetCountByGroupId(context, {group_id = 220000068}) ~= 45 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_CHALLENGE_SUCCESS_137(context, evt)
	-- 创建id为471的gadget
	if 0 ~= ScriptLib.CreateGadget(context, { config_id = 471 }) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : create_gadget")
	  return -1
	end
	
	return 0
end

-- 触发操作
function action_EVENT_CHALLENGE_FAIL_138(context, evt)
		-- 重新生成指定group，指定suite
		if 0 ~= ScriptLib.RefreshGroup(context, { group_id = 220000068, suite = 1 }) then
	    ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : refresh_group_to_suite")
			return -1
		end
	
	return 0
end