-- 基础信息
local base_info = {
	group_id = 133103577
}

--================================================================
-- 
-- 配置
-- 
--================================================================

-- 怪物
monsters = {
}

-- NPC
npcs = {
}

-- 装置
gadgets = {
	{ config_id = 577001, gadget_id = 70350083, pos = { x = 1013.826, y = 307.251, z = 1613.320 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577006, gadget_id = 70360094, pos = { x = 921.151, y = 313.936, z = 1745.430 }, rot = { x = 348.635, y = 303.618, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577007, gadget_id = 70690001, pos = { x = 985.448, y = 312.838, z = 1613.637 }, rot = { x = 357.151, y = 270.686, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577008, gadget_id = 70360094, pos = { x = 914.620, y = 315.513, z = 1749.772 }, rot = { x = 348.635, y = 303.619, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577009, gadget_id = 70360094, pos = { x = 964.938, y = 313.226, z = 1614.247 }, rot = { x = 335.353, y = 266.068, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577010, gadget_id = 70360094, pos = { x = 957.684, y = 316.562, z = 1613.749 }, rot = { x = 343.509, y = 280.150, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577011, gadget_id = 70690001, pos = { x = 926.401, y = 318.680, z = 1619.179 }, rot = { x = 355.023, y = 292.392, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577012, gadget_id = 70360094, pos = { x = 908.088, y = 317.089, z = 1754.115 }, rot = { x = 348.635, y = 303.618, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577013, gadget_id = 70360094, pos = { x = 901.557, y = 318.665, z = 1758.457 }, rot = { x = 348.635, y = 303.619, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577014, gadget_id = 70360096, pos = { x = 939.445, y = 319.989, z = 1613.307 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 24, route_id = 310300200, area_id = 6 },
	{ config_id = 577015, gadget_id = 70360094, pos = { x = 949.954, y = 318.754, z = 1613.989 }, rot = { x = 352.124, y = 292.495, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577016, gadget_id = 70360094, pos = { x = 895.026, y = 320.242, z = 1762.800 }, rot = { x = 348.635, y = 303.619, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577017, gadget_id = 70690001, pos = { x = 896.244, y = 321.418, z = 1636.373 }, rot = { x = 354.028, y = 19.459, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577018, gadget_id = 70360025, pos = { x = 790.672, y = 311.427, z = 1767.934 }, rot = { x = 349.686, y = 3.760, z = 339.846 }, level = 24, area_id = 6 },
	{ config_id = 577019, gadget_id = 70360094, pos = { x = 846.589, y = 332.955, z = 1783.792 }, rot = { x = 340.425, y = 246.754, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577020, gadget_id = 70360096, pos = { x = 904.514, y = 327.105, z = 1663.887 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 24, route_id = 310300201, area_id = 6 },
	{ config_id = 577021, gadget_id = 70360094, pos = { x = 934.497, y = 318.868, z = 1614.650 }, rot = { x = 19.306, y = 276.654, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577022, gadget_id = 70360094, pos = { x = 839.663, y = 335.635, z = 1780.817 }, rot = { x = 340.425, y = 246.754, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577023, gadget_id = 70360094, pos = { x = 920.425, y = 319.102, z = 1621.572 }, rot = { x = 359.571, y = 287.434, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577024, gadget_id = 70360094, pos = { x = 912.883, y = 319.162, z = 1624.254 }, rot = { x = 359.571, y = 287.434, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577025, gadget_id = 70360094, pos = { x = 903.931, y = 319.646, z = 1627.645 }, rot = { x = 358.380, y = 309.714, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577026, gadget_id = 70360094, pos = { x = 894.727, y = 320.830, z = 1630.332 }, rot = { x = 2.608, y = 2.952, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577027, gadget_id = 70690001, pos = { x = 916.139, y = 328.144, z = 1675.731 }, rot = { x = 11.748, y = 67.405, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577028, gadget_id = 70360094, pos = { x = 832.737, y = 338.315, z = 1777.842 }, rot = { x = 340.425, y = 246.755, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577029, gadget_id = 70690001, pos = { x = 937.333, y = 325.425, z = 1691.247 }, rot = { x = 14.932, y = 13.343, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577030, gadget_id = 70360094, pos = { x = 825.811, y = 340.996, z = 1774.867 }, rot = { x = 340.425, y = 246.754, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577031, gadget_id = 70360094, pos = { x = 818.886, y = 343.676, z = 1771.892 }, rot = { x = 340.425, y = 246.754, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577032, gadget_id = 70690001, pos = { x = 934.231, y = 314.619, z = 1732.677 }, rot = { x = 1.539, y = 314.946, z = 358.685 }, level = 24, area_id = 6 },
	{ config_id = 577033, gadget_id = 70690001, pos = { x = 924.781, y = 313.983, z = 1743.301 }, rot = { x = 355.125, y = 305.337, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577034, gadget_id = 70360094, pos = { x = 794.486, y = 319.438, z = 1767.210 }, rot = { x = 301.187, y = 80.193, z = 0.000 }, level = 1, area_id = 6 },
	{ config_id = 577035, gadget_id = 70360094, pos = { x = 923.186, y = 327.614, z = 1680.102 }, rot = { x = 15.683, y = 57.238, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577036, gadget_id = 70360096, pos = { x = 898.442, y = 321.388, z = 1759.510 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 24, route_id = 310300202, area_id = 6 },
	{ config_id = 577037, gadget_id = 70360096, pos = { x = 911.632, y = 319.303, z = 1751.722 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 24, route_id = 310300203, area_id = 6 },
	{ config_id = 577038, gadget_id = 70690001, pos = { x = 888.500, y = 321.644, z = 1768.410 }, rot = { x = 347.421, y = 312.919, z = 6.217 }, level = 24, area_id = 6 },
	{ config_id = 577039, gadget_id = 70690001, pos = { x = 877.898, y = 322.786, z = 1776.087 }, rot = { x = 340.994, y = 304.766, z = 355.712 }, level = 24, area_id = 6 },
	{ config_id = 577040, gadget_id = 70690001, pos = { x = 864.358, y = 326.541, z = 1781.502 }, rot = { x = 338.907, y = 280.186, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577041, gadget_id = 70690001, pos = { x = 850.911, y = 331.811, z = 1783.918 }, rot = { x = 340.615, y = 253.378, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577042, gadget_id = 70360094, pos = { x = 798.568, y = 326.282, z = 1767.916 }, rot = { x = 299.994, y = 79.189, z = 0.000 }, level = 1, area_id = 6 },
	{ config_id = 577043, gadget_id = 70360094, pos = { x = 898.549, y = 322.874, z = 1642.458 }, rot = { x = 342.831, y = 12.024, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577044, gadget_id = 70360094, pos = { x = 900.645, y = 325.655, z = 1648.907 }, rot = { x = 337.015, y = 15.004, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577045, gadget_id = 70360094, pos = { x = 902.885, y = 327.533, z = 1656.617 }, rot = { x = 337.015, y = 15.004, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577046, gadget_id = 70360096, pos = { x = 814.659, y = 343.726, z = 1770.701 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 24, route_id = 310300204, area_id = 6 },
	{ config_id = 577051, gadget_id = 70690016, pos = { x = 999.024, y = 264.519, z = 1613.137 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577052, gadget_id = 70900201, pos = { x = 790.559, y = 311.435, z = 1767.848 }, rot = { x = 0.000, y = 0.000, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577054, gadget_id = 70360094, pos = { x = 903.675, y = 322.168, z = 1662.186 }, rot = { x = 337.015, y = 15.004, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577055, gadget_id = 70360094, pos = { x = 929.738, y = 326.755, z = 1684.245 }, rot = { x = 14.360, y = 45.180, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577056, gadget_id = 70360094, pos = { x = 936.727, y = 325.917, z = 1689.386 }, rot = { x = 14.741, y = 22.386, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577057, gadget_id = 70360094, pos = { x = 938.290, y = 323.950, z = 1696.826 }, rot = { x = 14.171, y = 11.978, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577058, gadget_id = 70360094, pos = { x = 939.899, y = 321.992, z = 1704.414 }, rot = { x = 13.863, y = 351.205, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577059, gadget_id = 70360094, pos = { x = 938.727, y = 320.099, z = 1711.993 }, rot = { x = 13.584, y = 347.007, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577060, gadget_id = 70360094, pos = { x = 937.262, y = 318.220, z = 1719.635 }, rot = { x = 13.585, y = 347.006, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577061, gadget_id = 70360094, pos = { x = 936.043, y = 316.341, z = 1727.335 }, rot = { x = 13.585, y = 347.006, z = 0.000 }, level = 24, area_id = 6 },
	{ config_id = 577062, gadget_id = 70360094, pos = { x = 802.496, y = 333.211, z = 1768.666 }, rot = { x = 312.885, y = 81.035, z = 0.000 }, level = 1, area_id = 6 },
	{ config_id = 577063, gadget_id = 70360094, pos = { x = 807.845, y = 339.041, z = 1769.510 }, rot = { x = 312.885, y = 81.035, z = 0.000 }, level = 1, area_id = 6 }
}

-- 区域
regions = {
	{ config_id = 577047, shape = RegionShape.SPHERE, radius = 18.6, pos = { x = 938.470, y = 315.932, z = 1613.202 }, area_id = 6 },
	{ config_id = 577048, shape = RegionShape.SPHERE, radius = 23.1, pos = { x = 906.157, y = 319.063, z = 1663.808 }, area_id = 6 },
	{ config_id = 577049, shape = RegionShape.SPHERE, radius = 28.1, pos = { x = 907.848, y = 309.397, z = 1753.424 }, area_id = 6 },
	{ config_id = 577050, shape = RegionShape.SPHERE, radius = 5, pos = { x = 792.137, y = 311.275, z = 1768.919 }, area_id = 6 }
}

-- 触发器
triggers = {
	{ config_id = 1577002, name = "GADGET_CREATE_577002", event = EventType.EVENT_GADGET_CREATE, source = "", condition = "condition_EVENT_GADGET_CREATE_577002", action = "action_EVENT_GADGET_CREATE_577002", trigger_count = 0 },
	{ config_id = 1577003, name = "SELECT_OPTION_577003", event = EventType.EVENT_SELECT_OPTION, source = "", condition = "condition_EVENT_SELECT_OPTION_577003", action = "action_EVENT_SELECT_OPTION_577003", trigger_count = 0 },
	{ config_id = 1577004, name = "CHALLENGE_SUCCESS_577004", event = EventType.EVENT_CHALLENGE_SUCCESS, source = "2008", condition = "", action = "action_EVENT_CHALLENGE_SUCCESS_577004", trigger_count = 0 },
	{ config_id = 1577005, name = "CHALLENGE_FAIL_577005", event = EventType.EVENT_CHALLENGE_FAIL, source = "2008", condition = "", action = "action_EVENT_CHALLENGE_FAIL_577005", trigger_count = 0 },
	{ config_id = 1577047, name = "ENTER_REGION_577047", event = EventType.EVENT_ENTER_REGION, source = "", condition = "condition_EVENT_ENTER_REGION_577047", action = "action_EVENT_ENTER_REGION_577047" },
	{ config_id = 1577048, name = "ENTER_REGION_577048", event = EventType.EVENT_ENTER_REGION, source = "", condition = "condition_EVENT_ENTER_REGION_577048", action = "action_EVENT_ENTER_REGION_577048" },
	{ config_id = 1577049, name = "ENTER_REGION_577049", event = EventType.EVENT_ENTER_REGION, source = "", condition = "condition_EVENT_ENTER_REGION_577049", action = "action_EVENT_ENTER_REGION_577049" },
	{ config_id = 1577050, name = "ENTER_REGION_577050", event = EventType.EVENT_ENTER_REGION, source = "", condition = "condition_EVENT_ENTER_REGION_577050", action = "", tag = "666" },
	{ config_id = 1577053, name = "ANY_GADGET_DIE_577053", event = EventType.EVENT_ANY_GADGET_DIE, source = "", condition = "condition_EVENT_ANY_GADGET_DIE_577053", action = "", trigger_count = 0, tag = "888" }
}

-- 变量
variables = {
}

--================================================================
-- 
-- 初始化配置
-- 
--================================================================

-- 初始化时创建
init_config = {
	suite = 1,
	end_suite = 0,
	rand_suite = false
}

--================================================================
-- 
-- 小组配置
-- 
--================================================================

suites = {
	{
		-- suite_id = 1,
		-- description = ,
		monsters = { },
		gadgets = { 577001 },
		regions = { },
		triggers = { "GADGET_CREATE_577002", "SELECT_OPTION_577003" },
		rand_weight = 100
	},
	{
		-- suite_id = 2,
		-- description = ,
		monsters = { },
		gadgets = { 577007, 577009, 577010, 577011, 577014, 577015, 577021, 577023, 577024, 577051 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 3,
		-- description = ,
		monsters = { },
		gadgets = { 577017, 577020, 577025, 577026, 577043, 577044, 577045, 577054 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 4,
		-- description = ,
		monsters = { },
		gadgets = { 577006, 577008, 577012, 577013, 577016, 577027, 577029, 577032, 577033, 577035, 577036, 577037, 577055, 577056, 577057, 577058, 577059, 577060, 577061 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 5,
		-- description = ,
		monsters = { },
		gadgets = { 577018, 577019, 577022, 577028, 577030, 577031, 577034, 577038, 577039, 577040, 577041, 577042, 577046, 577052, 577062, 577063 },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 6,
		-- description = ,
		monsters = { },
		gadgets = { },
		regions = { 577047, 577048, 577049, 577050 },
		triggers = { "CHALLENGE_SUCCESS_577004", "CHALLENGE_FAIL_577005", "ENTER_REGION_577047", "ENTER_REGION_577048", "ENTER_REGION_577049", "ENTER_REGION_577050", "ANY_GADGET_DIE_577053" },
		rand_weight = 100
	},
	{
		-- suite_id = 7,
		-- description = ,
		monsters = { },
		gadgets = { },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 8,
		-- description = ,
		monsters = { },
		gadgets = { },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 9,
		-- description = ,
		monsters = { },
		gadgets = { },
		regions = { },
		triggers = { },
		rand_weight = 100
	},
	{
		-- suite_id = 10,
		-- description = ,
		monsters = { },
		gadgets = { },
		regions = { },
		triggers = { },
		rand_weight = 100
	}
}

--================================================================
-- 
-- 触发器
-- 
--================================================================

-- 触发条件
function condition_EVENT_GADGET_CREATE_577002(context, evt)
	if 577001 ~= evt.param1 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_GADGET_CREATE_577002(context, evt)
	-- 设置操作台选项
	if 0 ~= ScriptLib.SetWorktopOptionsByGroupId(context, 133103577, 577001, {2}) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : set_wok_options_by_configid")
		return -1
	end
	
	return 0
end

-- 触发条件
function condition_EVENT_SELECT_OPTION_577003(context, evt)
	-- 判断是gadgetid 577001 option_id 2
	if 577001 ~= evt.param1 then
		return false	
	end
	
	if 2 ~= evt.param2 then
		return false
	end
	
	
	return true
end

-- 触发操作
function action_EVENT_SELECT_OPTION_577003(context, evt)
	-- 添加suite2的新内容
	    ScriptLib.AddExtraGroupSuite(context, 133103577, 2)
	
	-- 添加suite6的新内容
	    ScriptLib.AddExtraGroupSuite(context, 133103577, 6)
	-- 创建编号为666（该挑战的识别id),挑战内容为127的区域挑战，具体参数填写方式，见DungeonChallengeData表中的注释，所有填写的值都必须是int类型
	ScriptLib.CreateFatherChallenge(context, 2008, 2008, 181, {success = 1, fail = 1})
	ScriptLib.AttachChildChallenge(context, 2008, 2009, 2009,{0,4, 666,1},{},{success=1,fail=1})
	ScriptLib.AttachChildChallenge(context, 2008, 2010, 2010,{0,2, 888,5},{},{success=0,fail=0})
	ScriptLib.StartFatherChallenge(context, 2008)
	ScriptLib.SetChallengeEventMark(context, 2008, ChallengeEventMarkType.FLIGHT_TIME)
	ScriptLib.SetChallengeEventMark(context, 2010, ChallengeEventMarkType.FLIGHT_GATHER_POINT)
	
	
	-- 触发镜头注目，注目位置为坐标（1000，310，1621），持续时间为3秒，并且为强制注目形式，不广播其他玩家
		local pos = {x=985, y=312, z=1613}
	    if 0 ~= ScriptLib.BeginCameraSceneLook(context, { look_pos = pos, duration = 3, is_force = true, is_broadcast = false, is_recover_keep_current = true, delay = 0 }) then
					return -1
				end 
	
	-- 删除指定group： 133103577 ；指定config：577001；物件身上指定option：2；
	if 0 ~= ScriptLib.DelWorktopOptionByGroupId(context, 133103577, 577001, 2) then
		return -1
	end
	
	return 0
end

-- 触发操作
function action_EVENT_CHALLENGE_SUCCESS_577004(context, evt)
		-- 重新生成指定group，指定suite
		if 0 ~= ScriptLib.RefreshGroup(context, { group_id = 133103577, suite = 1 }) then
	    ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : refresh_group_to_suite")
			return -1
		end
	
	return 0
end

-- 触发操作
function action_EVENT_CHALLENGE_FAIL_577005(context, evt)
		-- 重新生成指定group，指定suite
		if 0 ~= ScriptLib.RefreshGroup(context, { group_id = 133103577, suite = 1 }) then
	    ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : refresh_group_to_suite")
			return -1
		end
	
	return 0
end

-- 触发条件
function condition_EVENT_ENTER_REGION_577047(context, evt)
	if evt.param1 ~= 577047 then return false end
	
	-- 判断角色数量不少于1
	if ScriptLib.GetRegionEntityCount(context, { region_eid = evt.source_eid, entity_type = EntityType.AVATAR }) < 1 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_ENTER_REGION_577047(context, evt)
	-- 添加suite3的新内容
	    ScriptLib.AddExtraGroupSuite(context, 133103577, 3)
	
	return 0
end

-- 触发条件
function condition_EVENT_ENTER_REGION_577048(context, evt)
	if evt.param1 ~= 577048 then return false end
	
	-- 判断角色数量不少于1
	if ScriptLib.GetRegionEntityCount(context, { region_eid = evt.source_eid, entity_type = EntityType.AVATAR }) < 1 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_ENTER_REGION_577048(context, evt)
	-- 添加suite4的新内容
	    ScriptLib.AddExtraGroupSuite(context, 133103577, 4)
	
	return 0
end

-- 触发条件
function condition_EVENT_ENTER_REGION_577049(context, evt)
	if evt.param1 ~= 577049 then return false end
	
	-- 判断角色数量不少于1
	if ScriptLib.GetRegionEntityCount(context, { region_eid = evt.source_eid, entity_type = EntityType.AVATAR }) < 1 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_ENTER_REGION_577049(context, evt)
	-- 添加suite5的新内容
	    ScriptLib.AddExtraGroupSuite(context, 133103577, 5)
	
	-- 删除suite2的所有内容
	    ScriptLib.RemoveExtraGroupSuite(context, 133103577, 2)
	
	-- 删除suite3的所有内容
	    ScriptLib.RemoveExtraGroupSuite(context, 133103577, 3)
	
	return 0
end

-- 触发条件
function condition_EVENT_ENTER_REGION_577050(context, evt)
	if evt.param1 ~= 577050 then return false end
	
	-- 判断角色数量不少于1
	if ScriptLib.GetRegionEntityCount(context, { region_eid = evt.source_eid, entity_type = EntityType.AVATAR }) < 1 then
		return false
	end
	
	return true
end

-- 触发条件
function condition_EVENT_ANY_GADGET_DIE_577053(context, evt)
	if (577046 == evt.param1)  or (577036 == evt.param1) or (577037 == evt.param1) or (577020 == evt.param1) or (577014 == evt.param1) then
	    return true
	end
	
	return false
end

require "FlyChallenge"