-- 基础信息
local base_info = {
	group_id = 133003089
}

--================================================================
-- 
-- 配置
-- 
--================================================================

-- 怪物
monsters = {
}

-- NPC
npcs = {
}

-- 装置
gadgets = {
	{ config_id = 89001, gadget_id = 70690011, pos = { x = 1985.004, y = 192.805, z = -1220.230 }, rot = { x = 0.000, y = 108.692, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89002, gadget_id = 70690001, pos = { x = 1986.590, y = 216.105, z = -1236.404 }, rot = { x = 358.974, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89003, gadget_id = 70690001, pos = { x = 1988.164, y = 216.284, z = -1246.277 }, rot = { x = 358.973, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89004, gadget_id = 70690001, pos = { x = 1989.739, y = 216.464, z = -1256.150 }, rot = { x = 358.974, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89005, gadget_id = 70690001, pos = { x = 1991.312, y = 216.643, z = -1266.024 }, rot = { x = 358.974, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89006, gadget_id = 70690001, pos = { x = 1995.624, y = 212.271, z = -1293.065 }, rot = { x = 358.973, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89007, gadget_id = 70690001, pos = { x = 1997.196, y = 212.450, z = -1302.938 }, rot = { x = 358.974, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89008, gadget_id = 70690001, pos = { x = 1998.772, y = 212.629, z = -1312.812 }, rot = { x = 358.974, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89009, gadget_id = 70690001, pos = { x = 2000.345, y = 212.808, z = -1322.685 }, rot = { x = 358.973, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89015, gadget_id = 70690001, pos = { x = 2014.114, y = 223.175, z = -1414.935 }, rot = { x = 358.973, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 1 },
	{ config_id = 89016, gadget_id = 70690001, pos = { x = 2010.443, y = 226.360, z = -1392.016 }, rot = { x = 358.974, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89017, gadget_id = 70690001, pos = { x = 2008.870, y = 226.181, z = -1382.142 }, rot = { x = 358.974, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89018, gadget_id = 70690001, pos = { x = 2007.295, y = 226.002, z = -1372.269 }, rot = { x = 358.973, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89019, gadget_id = 70690001, pos = { x = 2005.721, y = 225.822, z = -1362.396 }, rot = { x = 358.974, y = 170.941, z = 0.000 }, level = 5, persistent = true, area_id = 2 },
	{ config_id = 89020, gadget_id = 70690011, pos = { x = 2016.878, y = 215.141, z = -1440.446 }, rot = { x = 0.000, y = 339.034, z = 0.000 }, level = 1, persistent = true, area_id = 1 },
	{ config_id = 89021, gadget_id = 70690001, pos = { x = 2022.177, y = 239.166, z = -1455.828 }, rot = { x = 358.974, y = 161.827, z = 0.000 }, level = 5, persistent = true, area_id = 1 },
	{ config_id = 89022, gadget_id = 70690001, pos = { x = 2025.294, y = 239.345, z = -1465.328 }, rot = { x = 358.973, y = 161.827, z = 0.000 }, level = 5, persistent = true, area_id = 1 },
	{ config_id = 89023, gadget_id = 70690001, pos = { x = 2028.414, y = 239.524, z = -1474.828 }, rot = { x = 358.974, y = 161.827, z = 0.000 }, level = 5, persistent = true, area_id = 1 },
	{ config_id = 89024, gadget_id = 70690001, pos = { x = 2031.530, y = 239.703, z = -1484.327 }, rot = { x = 358.974, y = 161.827, z = 0.000 }, level = 5, persistent = true, area_id = 1 },
	{ config_id = 89025, gadget_id = 70690001, pos = { x = 2034.622, y = 234.291, z = -1505.086 }, rot = { x = 358.973, y = 176.492, z = 0.000 }, level = 5, persistent = true, area_id = 1 },
	{ config_id = 89026, gadget_id = 70690001, pos = { x = 2035.231, y = 234.470, z = -1515.064 }, rot = { x = 358.974, y = 176.492, z = 0.000 }, level = 5, persistent = true, area_id = 1 },
	{ config_id = 89028, gadget_id = 70690011, pos = { x = 2003.379, y = 201.764, z = -1342.803 }, rot = { x = 0.000, y = 108.692, z = 0.000 }, level = 5, persistent = true, area_id = 2 }
}

-- 区域
regions = {
	{ config_id = 89010, shape = RegionShape.SPHERE, radius = 80, pos = { x = 2011.854, y = 202.209, z = -1206.098 }, area_id = 2 },
	{ config_id = 89011, shape = RegionShape.SPHERE, radius = 25, pos = { x = 2047.593, y = 232.967, z = -1546.931 }, area_id = 1 }
}

-- 触发器
triggers = {
	{ config_id = 1089010, name = "ENTER_REGION_89010", event = EventType.EVENT_ENTER_REGION, source = "", condition = "condition_EVENT_ENTER_REGION_89010", action = "action_EVENT_ENTER_REGION_89010", trigger_count = 0 },
	{ config_id = 1089011, name = "ENTER_REGION_89011", event = EventType.EVENT_ENTER_REGION, source = "", condition = "condition_EVENT_ENTER_REGION_89011", action = "action_EVENT_ENTER_REGION_89011" },
	{ config_id = 1089027, name = "TIME_AXIS_PASS_89027", event = EventType.EVENT_TIME_AXIS_PASS, source = "T_sight", condition = "", action = "action_EVENT_TIME_AXIS_PASS_89027" }
}

-- 变量
variables = {
}

--================================================================
-- 
-- 初始化配置
-- 
--================================================================

-- 初始化时创建
init_config = {
	suite = 1,
	end_suite = 0,
	rand_suite = false
}

--================================================================
-- 
-- 小组配置
-- 
--================================================================

suites = {
	{
		-- suite_id = 1,
		-- description = ,
		monsters = { },
		gadgets = { 89001, 89002, 89003, 89004, 89005, 89006, 89007, 89008, 89009, 89015, 89016, 89017, 89018, 89019, 89020, 89021, 89022, 89023, 89024, 89025, 89026, 89028 },
		regions = { 89010, 89011 },
		triggers = { "ENTER_REGION_89010", "ENTER_REGION_89011", "TIME_AXIS_PASS_89027" },
		rand_weight = 100
	},
	{
		-- suite_id = 2,
		-- description = ,
		monsters = { },
		gadgets = { },
		regions = { },
		triggers = { },
		rand_weight = 100
	}
}

--================================================================
-- 
-- 触发器
-- 
--================================================================

-- 触发条件
function condition_EVENT_ENTER_REGION_89010(context, evt)
	if evt.param1 ~= 89010 then return false end
	
	-- 判断角色数量不少于1
	if ScriptLib.GetRegionEntityCount(context, { region_eid = evt.source_eid, entity_type = EntityType.AVATAR }) < 1 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_ENTER_REGION_89010(context, evt)
	-- 创建标识为"T_sight"，时间节点为{3}的时间轴，false用于控制该时间轴是否循环
	ScriptLib.InitTimeAxis(context, "T_sight", {3}, false)
	
	
	return 0
end

-- 触发条件
function condition_EVENT_ENTER_REGION_89011(context, evt)
	if evt.param1 ~= 89011 then return false end
	
	-- 判断角色数量不少于1
	if ScriptLib.GetRegionEntityCount(context, { region_eid = evt.source_eid, entity_type = EntityType.AVATAR }) < 1 then
		return false
	end
	
	return true
end

-- 触发操作
function action_EVENT_ENTER_REGION_89011(context, evt)
		-- 重新生成指定group，指定suite
		if 0 ~= ScriptLib.RefreshGroup(context, { group_id = 133003089, suite = 2 }) then
	    ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : refresh_group_to_suite")
			return -1
		end
	
	return 0
end

-- 触发操作
function action_EVENT_TIME_AXIS_PASS_89027(context, evt)
	-- 触发镜头注目，注目位置为坐标（1985，197，-1220），持续时间为3秒，并且为强制注目形式，不广播其他玩家
		local pos = {x=1985, y=197, z=-1220}
	  local pos_follow = {x=0, y=0, z=0}
	    if 0 ~= ScriptLib.BeginCameraSceneLook(context, { look_pos = pos, is_allow_input = true, duration = 3, is_force = true, is_broadcast = false, is_recover_keep_current = true, delay = 0,
	                                                      is_set_follow_pos = false, follow_pos = pos_follow, is_force_walk = false, is_change_play_mode = false,
	                                                      is_set_screen_XY = false, screen_x = 0, screen_y = 0 }) then
					ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : active_cameraLook_Begin")
	        return -1
				end 
	
	-- 调用提示id为 400872 的提示UI，会显示在屏幕中央偏下位置，id索引自 ReminderData表格
	if 0 ~= ScriptLib.ShowReminder(context, 400872) then
	  ScriptLib.PrintContextLog(context, "@@ LUA_WARNING : active_reminder_ui")
		return -1
	end
	
	return 0
end